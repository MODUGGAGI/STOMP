<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ë©€í‹° ì±„íŒ…ë°©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        #chat-page { margin: 20px; }
        #messageArea { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;}
        .message { margin-bottom: 5px; }
    </style>
</head>
<body>

<div id="chat-page">
    <h2>ë©€í‹° ì±„íŒ…ë°© ğŸ’¬</h2>

    <div>
        <label>ë°© ë²ˆí˜¸: </label>
        <input type="text" id="roomIdInput" value="1" placeholder="ë°© ë²ˆí˜¸ (ì˜ˆ: 1)" />
    </div>
    <br/>
    <div>
        <label>ë‹‰ë„¤ì„: </label>
        <input type="text" id="senderInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
    </div>
    <br/>
    <button onclick="connect()">ì±„íŒ…ë°© ì…ì¥</button>

    <div id="chat-box" style="display:none;">
        <hr/>
        <h3>Room: <span id="room-id-display"></span></h3>
        <div id="messageArea"></div>
        <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ ì…ë ¥..." />
        <button onclick="sendMessage()">ë³´ë‚´ê¸°</button>
    </div>
</div>

<script>
    var stompClient = null;
    var roomId = null;

    function connect() {
        var sender = document.getElementById('senderInput').value;
        var roomInput = document.getElementById('roomIdInput').value;

        if(!sender || !roomInput) {
            alert("ë°© ë²ˆí˜¸ì™€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        roomId = roomInput; // ë°© ë²ˆí˜¸ ì €ì¥

        var socket = new SockJS('/ws');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            document.getElementById('chat-box').style.display = 'block';
            document.getElementById('room-id-display').innerText = roomId;

            // ë™ì  êµ¬ë… ("/topic/room/" + roomId)
            // ì´ì œ ë‚´ê°€ ì…ë ¥í•œ ë°© ë²ˆí˜¸ì˜ ë©”ì‹œì§€ë§Œ ë“£ìŠµë‹ˆë‹¤.
            stompClient.subscribe('/topic/room/' + roomId, function (messageOutput) {
                showMessage(JSON.parse(messageOutput.body));
            });
        });
    }

    function sendMessage() {
        var sender = document.getElementById('senderInput').value;
        var messageContent = document.getElementById('messageInput').value;

        if(messageContent && stompClient) {
            var chatMessage = {
                roomId: roomId, // ë©”ì‹œì§€ì— ë°© ë²ˆí˜¸ë„ ê°™ì´ ì‹¤ì–´ ë³´ëƒ„ (ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ)
                sender: sender,
                content: messageContent
            };

            // ë™ì  ì „ì†¡ ("/app/chat/" + roomId)
            // ì»¨íŠ¸ë¡¤ëŸ¬ì˜ @MessageMapping("/chat/{roomId}")ë¡œ ë‚ ì•„ê°‘ë‹ˆë‹¤.
            stompClient.send("/app/chat/" + roomId, {}, JSON.stringify(chatMessage));
            document.getElementById('messageInput').value = '';
        }
    }

    function showMessage(message) {
        var messageArea = document.getElementById('messageArea');
        var messageElement = document.createElement('div');
        messageElement.classList.add('message');
        messageElement.innerHTML = "<strong>" + message.sender + ":</strong> " + message.content;
        messageArea.appendChild(messageElement);
        messageArea.scrollTop = messageArea.scrollHeight;
    }
</script>

</body>
</html>